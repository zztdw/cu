{% extends 'base.html' %}
{% block head %}
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="" /> 
  <title>{{cafeteria.name}}</title>

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
    crossorigin="anonymous"
  />

  <link
    href="{{ url_for('static', filename='./worker/styles.css') }}"
    rel="stylesheet"
  />
{% endblock %}
{% block body%}
<header>
  <h1>{{ cafeteria.name }}</h1>
</header>

<main class="text-center container-fluid">
  <p id="timer"></p>
  <script src="{{ url_for('static', filename='./worker/app.js') }}"></script>

  <div class="row">
    <!--三个时间按钮：5 分钟、5 -15 分钟、> 20 分钟-->
    <div class="col-sm">
        <button type="submit" class="btn btn-success time-text" id="five">< 5 min</button>
    </div>
    <div class="col-sm">
        <button type="submit" class="btn btn-warning time-text" id="fifteen">5 - 15 min</button>
    </div>
    <div class="col-sm">
        <button type="submit" class="btn btn-danger time-text" id="twenty">> 15 min</button>
    </div>
  </div>
</main>
<!--注销和餐厅开/关开关切换的页脚 -->
<footer style="margin: 0 5px 0 5px">
  <div class="logout">
    <button type="button" class="btn btn-lg btn-primary float-start" id="logout">
      登出
    </button>
  </div>
  <form class="options" method="post">
<!--修改开关切换以允许右侧和右侧的文本-->
    <div
      id="enabled"
      style="display: flex; align-items: center"
      class="float-end"
    >
      <label class="form-check-label" for="flexSwitchCheckChecked">关</label>
      <div class="form-check form-switch">
        {% if cafeteria.status == "Open" %}
          <input class="form-check-input" type="checkbox" role="switch" id="check" checked>
        {% else %}
          <input class="form-check-input" type="checkbox" role="switch" id="check">
        {% endif %}
        <label class="form-check-label" for="flexSwitchCheckChecked">开</label>
      </div>
    </div>
  </form>
</footer>
<script>
  //将 api 调用发送到 flask 应用程序，flask 最终将请求发送到后端
// 定义一个异步函数 state，传入 checked 参数
const state = async (checked) => {
  // 如果 checked 为真，发送请求到后端获取开餐厅状态
  if(checked){
    const response = await fetch("/location/{{cafeteria.id}}?status=Open");
  }
  // 否则发送请求到后端获取关餐厅状态
  else{
    const response = await fetch("/location/{{cafeteria.id}}?status=Closed");
  }
}

// 定义一个异步函数 changeWait，传入 waittime 参数
async function changeWait(waittime){
  // 如果 waittime 为 "five"，发送请求到后端获取小于 5 分钟的等待时间信息
  if(waittime == "five"){
    const response = await fetch("/location/{{cafeteria.id}}?wait_times=lt5min");
  }
  // 如果 waittime 为 "fifteen"，发送请求到后端获取 5 到 15 分钟的等待时间信息
  else if(waittime == 'fifteen'){
    const response = await fetch("/location/{{cafeteria.id}}?wait_times=5-15min");
  }
  // 否则发送请求到后端获取大于 20 分钟的等待时间信息
  else{
    const response = await fetch("/location/{{cafeteria.id}}?wait_times=gt20min");
  }
}

// 定义一个异步函数 logout
async function logout(){
  // 发送请求到后端注销
  const response = await fetch("/logout");
  // 重定向到 /dashboard 页面
  window.location.href = "/dashboard";
}

// 定义一个异步函数 changeState
async function changeState(){
  // 获取具有 id 为 check 的元素的 checked 属性
  let checked = $("#check").prop("checked")
  // 调用 state 函数并传入 checked 参数
  state(checked)
}

// 给具有 id 为 five 的元素添加点击事件监听器，调用 changeWait 函数并传入 "five" 参数
$('#five').click(()=>{changeWait("five")})
// 给具有 id 为 fifteen 的元素添加点击事件监听器，调用 changeWait 函数并传入 "fifteen" 参数
$('#fifteen').click(()=>{changeWait("fifteen")})
// 给具有 id 为 twenty 的元素添加点击事件监听器，调用 changeWait 函数并传入 "twenty" 参数
$('#twenty').click(()=>{changeWait("twenty")})
// 给具有 id 为 check 的元素添加 change 事件监听器，调用 changeState 函数
$("#check").change(changeState)
// 给具有 id 为 logout 的元素添加点击事件监听器，调用 logout 函数
$("#logout").click(logout)

</script>
{% endblock%}


